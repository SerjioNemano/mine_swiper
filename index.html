<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>

<script>
/*–ó–∞–¥–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—è*/
let fieldLength = 10;

/*–†–∞—Å—á–µ—Ç —à–∏—Ä–∏–Ω—ã –ø–æ–ª—è*/
let width = (fieldLength*20)+(fieldLength*4); 

/*–ó–∞–¥–∞–µ–º –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ*/
let mineField = [];

/*–ó–∞–¥–∞–µ–º –∫–æ–ª -–≤–æ –º–∏–Ω*/
let mineAmount = 14;

/*–ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –º–∏–Ω*/
let minesCoordinats = [];

/*–ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π*/
let mineFree = [];

/*—Ñ—É–Ω–∫—Ü–∏—è-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –º–∏–Ω*/
function getCoordinat(max) {
    let x = Math.floor(Math.random() * (Math.floor(max)));
    let y = Math.floor(Math.random() * (Math.floor(max)));
    return x+':'+y;
}
/*—Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫—É —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç*/
/*–ø–æ –∫–ª—é—á—É x –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ x */
/*–ø–æ –∫–ª—é—á—É y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ y*/
function returnCoordinats(arr) {
    let coordinats = arr.split(':')
    return {
        x:Number(coordinats[0]),
        y:Number(coordinats[1]),
    }
}

/*–∏—â–µ–º —Å–æ—Å–µ–¥–µ–π. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ —Å–æ—Å–µ–¥–µ–π*/
function findNeighbors(x,y) {
    let neighborsArr = [];
    let arr = [-1,0,1];
    let neighborsX = ''
    let neighborsY = ''
    for (let i = 0; i < arr.length; i++){
        for (let j = 0; j < arr.length; j++){
            neighborsX = Number(x) + arr[i];
            neighborsY = Number(y) + arr[j];
            if (neighborsX >=0 && neighborsX < fieldLength && neighborsY >=0 && neighborsY < fieldLength) {
                let neighborCoordinats = neighborsX+':'+neighborsY;
                if (neighborCoordinats != x+':'+y) {
                    neighborsArr.push(neighborCoordinats)
                }
            }
        }
    }
    return neighborsArr;
}

/*–†–∞—Å—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏*/
function hints(mineField) {
    for (let i = 0; i < mineField.length; i++){
        for (let j = 0; j < mineField.length; j++){
            if (mineField[i][j] == 'm'){
                let neighbors = findNeighbors(i,j)
                for(let x = 0; x < neighbors.length; x++){
                    let neighborsCoordinats = returnCoordinats(neighbors[x])
                    let row = neighborsCoordinats.x;
                    let col = neighborsCoordinats.y;
                    if (mineField[row][col] != 'm') {
                        mineField[row][col] ++;
                    }
                }
            }
        }
    }
}

/*–§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –º–∏–Ω*/
for(let i = 0; i < mineAmount; i++){
    let mine = getCoordinat(fieldLength);

    while(minesCoordinats.indexOf(mine) !== -1){//–∏—Å–∫–ª—é—á–∞–µ–º –ø–æ–≤—Ç–æ—Ä—ã
        mine = getCoordinat(fieldLength);
    }
    minesCoordinats.push(mine);

}
/*–ú–∞—Å—Å–∏–≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ñ–ª–∞–≥–æ–≤*/
let flags = []

/*—Ä–∏—Å—É–µ–º –ø–æ–ª–µ, —Å—Ç–∞–≤–∏–º –º–∏–Ω—ã*/
let field = document.createElement('div');
field.className = "field";
field.setAttribute("style","width:"+width+"px");
document.body.append(field);
for (let i = 0; i < fieldLength; i++){
    mineField[i] = [];
    for (let j = 0; j < fieldLength; j++){
        if (minesCoordinats.indexOf(i+':'+j) != -1) {
            mineField[i][j] = 'm';
        }
        else{
            mineField[i][j] = 0;
        }
        let cell = document.createElement('div');
        cell.className = "cell";
        cell.setAttribute('row', i)
        cell.setAttribute('col', j)
        field.append(cell);
    }
}

/*–°—Ç–∞–≤–∏–º –∏ —É–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥*/
function toggleFlag(elementDOM) {
    let el = elementDOM;
    flags.length < mineAmount ? el.classList.toggle('flag') :  el.classList.remove('flag')
        let row = el.getAttribute('row');
        let col = el.getAttribute('col');
    if (el.matches('.flag') ) {
        flags.push(row+':'+col)
    } else {
        var newArray = flags.filter(element =>  element != row+':'+col)
        flags = [];
        flags = newArray
    }
    if (flags.length == mineAmount) {
        let x = 0;
        for (let i = 0; i < flags.length; i++) {
            if (minesCoordinats.indexOf(flags[i]) !== -1) {
                x++
            }
        }
        if (x == mineAmount) {
            alert('–ü–æ–±–µ–¥–∞');
            return false;
        }
    }
}
console.log(minesCoordinats);
/*–†–∞—Å—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏*/
hints(mineField)

/*–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è*/
let btn = document.querySelector('.field');
btn.oncontextmenu= function(){
    return false
}
btn.onmousedown = function($e) {
    if ($e.target.matches('.cell')) {// –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞–∂–∞—Ç–∏—è –º–µ–∂–¥—É —è—á–µ–π–∫–∞–º–∏
        let thisCell = $e.target;
        let row = Number(thisCell.getAttribute('row'));
        let col = Number(thisCell.getAttribute('col'));
        $e.which == 1 ? checkCell(row,col) : toggleFlag(thisCell)
    }
}
/*–ü–æ–ª—É—á–µ–Ω–∏–µ –î–û–ú —ç–ª–µ–∏–º–µ–Ω—Ç–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º*/
function getElementByCoordinat(rowCoordinat, colCoordinat) {
    let cellCollection = document.getElementsByClassName('cell');
    for(let i = 0; i< cellCollection.length; i++){
        if ( cellCollection[i].attributes.row.value == rowCoordinat && 
             cellCollection[i].attributes.col.value == colCoordinat ) {
            return cellCollection[i];
        }
    }
}
function checkCell(row,col) {
    let thisCell = getElementByCoordinat(row,col);
    if (thisCell.matches('.flag')) {
        return false
    }
    thisCell.innerHTML = mineField[row][col];
    if(mineField[row][col] == 'm'){
        thisCell.classList.add('red');
    }
    if(mineField[row][col] > 0 && mineField[row][col] != 'm'){
        thisCell.classList.add('white');
    }
    if(mineField[row][col] == 0){
        mineFree.push(row+':'+col)
        thisCell.classList.add('white');
        let neighbors = findNeighbors(row,col);
        for(let i = 0; i < neighbors.length; i++){
            let neighborsCoordinats = returnCoordinats(neighbors[i])
            let nrow = neighborsCoordinats.x;
            let ncol = neighborsCoordinats.y;
            if (mineFree.indexOf(neighbors[i]) === -1) {
                checkCell(nrow,ncol)
            }
        }
    }
}

</script>
<style>
    .field{
        display: inline-block;
    }
    .cell{
        float: left;
        height: 20px;
        width: 20px;
        background-color: lightgray;
        margin: 1px;
        border: solid black 1px;
    }
    .cell:hover{
        background-color: gray;
    }
    .red{
        background-color: red;
    }
    .white{
        background-color: white;
    }
    .green{
        background-color: green;
    }
    .flag::before{
        content: "üö©";
        transform: rotate(-18deg);
        margin-left: 2px;
        position: absolute;
    }
</style>
</body>
</html>